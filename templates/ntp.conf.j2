# NTP configuration
# {{ ansible_managed }}

# Drift file
driftfile /var/lib/ntp/ntp.drift

# Leap seconds definition
leapfile /usr/share/zoneinfo/leap-seconds.list

# Statistics directory
statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# NTP servers
{% for ntp_server in ntp_servers %}
server {{ ntp_server }} iburst
{% endfor %}

# Fallback to local clock if no servers available
server 127.127.1.0
fudge 127.127.1.0 stratum 10

# Access control
restrict -4 default kod notrap nomodify nopeer noquery limited
restrict -6 default kod notrap nomodify nopeer noquery limited

# Local users may interrogate the ntp server more closely
restrict 127.0.0.1
restrict ::1

# Clients from this subnet have unlimited access
restrict 192.168.0.0 mask 255.255.0.0 nomodify notrap
restrict 10.0.0.0 mask 255.0.0.0 nomodify notrap
restrict 172.16.0.0 mask 255.240.0.0 nomodify notrap